general:
  build_dir: .

machine:
  environment:
    RAILS_ENV: "test"
    RACK_ENV: "test"
    BING_ACCOUNT_KEY: "fSRaLCGmQL2frvHLn3Ip8DIAj+6N5+r0RsayplnVfmw="

#database:
#  pre:
#    - bundle exec rake db:test:migrate
#    - bundle exec rake db:schema:load

dependencies:
  # Compute the assets once and cache them
  post:
    - bundle exec rake assets:precompile assets:clean_expired:
          environment:
            RAILS_GROUPS: assets
  cache_directories:
    - "public/assets"

deployment:
  staging:
    branch: staging
    commands:
      - heroku maintenance:on --app technosocialstaging
      - heroku scale worker=0 --app technosocialstaging
      - git push git@heroku.com:technosocialstaging.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake assets:precompile --app technosocialstaging
      - heroku run rake db:migrate --app technosocialstaging
      - heroku scale worker=1 --app technosocialstaging
      - heroku maintenance:off --app technosocialstaging
  production:
    branch: production
    commands:
      - heroku maintenance:on --app technosocial
      - heroku scale worker=0 --app technosocial
      - git push git@heroku.com:technosocial.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake assets:precompile --app technosocial
      - heroku run rake db:migrate --app technosocial
      - heroku scale worker=1 --app technosocial
      - heroku maintenance:off --app technosocial

